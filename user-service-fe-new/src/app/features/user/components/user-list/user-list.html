<div class="user-list-container">
    <div class="header">
      <h1>User List</h1>
      <button (click)="goToDashboard()" class="btn btn-dashboard">
        Dashboard
      </button>
    </div>
  
    <!-- Dùng ng-container để tạo alias, tránh multiple subscriptions -->
    <ng-container *ngIf="{
      error: errorMsg$ | async,
      loading: loading$ | async,
      users: users$ | async,
      pagination: pagination$ | async
    } as vm">
      
      <div class="error-message" *ngIf="vm.error">
        {{ vm.error }}
      </div>
  
      <div class="loading" *ngIf="vm.loading">
        Loading...
      </div>
  
      <div class="table-container" *ngIf="!vm.loading">
        <table class="user-table">
          <thead>
            <tr>
              <th>Email</th>
              <th>Username</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let user of vm.users; trackBy: trackByUserId" 
                [class.user-disabled]="isDisabled(user)">
              <td>{{ getUserEmail(user) }}</td>
              <td>{{ getUserName(user) }}</td>
              <td>
                <span
                  class="status-badge"
                  [class.status-unverified]="getUserStatus(user) === 'unverified'"
                  [class.status-active]="getUserStatus(user) === 'active'"
                  [class.status-disabled]="getUserStatus(user) === 'disabled'"
                >
                  {{ getUserStatusLabel(user) }}
                </span>
              </td>
              <td class="actions">
                <button
                  class="btn btn-toggle"
                  (click)="toggleUserStatus(user)"
                  [disabled]="vm.loading"
                >
                  {{ isDisabled(user) ? 'Enable' : 'Disable' }}
                </button>
                <button
                  class="btn btn-delete"
                  (click)="hardDeleteUser(user)"
                  [disabled]="vm.loading"
                >
                  Delete
                </button>
                <button
                  class="btn btn-view"
                  (click)="viewUserDetail(user)"
                  [disabled]="vm.loading"
                >
                  View Detail
                </button>
              </td>
            </tr>
            <tr *ngIf="!vm.users || vm.users.length === 0">
              <td colspan="4" class="no-data">No data</td>
            </tr>
          </tbody>
        </table>
  
        <div class="pagination" *ngIf="vm.pagination && vm.pagination.totalPages > 1">
          <button
            class="btn-pagination"
            (click)="goToPage(vm.pagination.page - 1)"
            [disabled]="vm.pagination.page <= 1"
          >
            Previous
          </button>
    
          <span class="page-info">
            Page {{ vm.pagination.page }} / {{ vm.pagination.totalPages }}
            (Total: {{ vm.pagination.total }})
          </span>
    
          <button
            class="btn-pagination"
            (click)="goToPage(vm.pagination.page + 1)"
            [disabled]="vm.pagination.page >= vm.pagination.totalPages"
          >
            Next
          </button>
        </div>
      </div>
    </ng-container>
  </div>
  